---
import { Font } from "astro:assets";
import Layout from "./Layout.astro";
import formatDate from "@/utils/formatDate";
import ChapterContent from "~/ChapterContent.astro";

interface Props {
  title: string;
  ficTitle: string;
  date: Date;
  notes?: string;
  lastModified?: Date;
}

const { title, ficTitle, date, notes, lastModified }: Props = Astro.props;
---
<Layout title={`${ficTitle}, ${title}`}>
  <Fragment slot="head">
    <meta name="description" content={notes} />
    <Font cssVariable="--serif" preload />
  </Fragment>
  <slot name="breadcrumbs" />

  <main>
    <ChapterContent lastModified={lastModified} notes={notes}>
      <Fragment slot="title">
        <h1>{ficTitle}</h1>
        <h2>{title}</h2>
        <time datetime={formatDate(date, true)}>
          Published on {formatDate(date)}
        </time>
      </Fragment>
      
      <slot />
    </ChapterContent>

    <slot name="pagination" />
  </main>
</Layout>

<style>
  main {
    display: grid;
    place-content: center;
    margin: 1rem auto 2rem;

    @media screen and (max-width: 1000px) {
      margin: 1rem 1rem 2rem;
    }
  }
  
  article, blockquote {
    max-width: 80ch;
    font-family: var(--serif-font);
  }

  header {
    blockquote {
      margin: 1rem;
      font-size: calc(35px / 2);

      &::before {
        display: block;
        content: "Authorâ€™s Notes:";
        font-weight: bold;
        line-height: 1;
        alt: "Author's Notes:";
      }
    }

    @media screen and (max-width: 800px) {
      time { font-size: calc(1rem - 1px); }
    }
  }

  article {
    margin: 1rem 0;
    font-size: 1.25rem;
    line-height: 1.75;
    margin-trim: block;

    p { margin-block: 1lh; }
    @supports not (margin-trim: block) {
      :first-child { margin-block-start: 0; }
      :last-child { margin-block-end: 0; }
    }
  }
</style>